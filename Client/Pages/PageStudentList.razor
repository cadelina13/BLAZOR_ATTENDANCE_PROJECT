@page "/studentlist"
@code {
    List<Student> studentlist;
    protected override async Task OnInitializedAsync()
    {
        WebHeader.TITLE = "Students";
        await LoadData();
    }

    async Task LoadData()
    {
        studentlist = null;
        studentlist = await db.GetList<Student>(table.table_student);
        if (studentlist == null) studentlist = new();
    }
    async Task OnAddClick()
    {
        var d = await dialog.Show<DialogAddStudent>("Add Student", new DialogOptions() { MaxWidth = MaxWidth.ExtraSmall }).Result;
        if (!d.Cancelled)
        {
            var data = (Student)d.Data;
            if (studentlist == null) studentlist = new();
            studentlist.Add(data);
            await db.SaveRecord<List<Student>>(table.table_student, studentlist);
            await LoadData();
            snackbar.Add($"{data.FistName} successfully added to the list.");
        }
    }
    async Task EditStudentClick(Student data)
    {
        var d = await dialog.Show<DialogEditStudent>("Edit",
            new DialogParameters() { ["data"] = data },
            new DialogOptions() { MaxWidth = MaxWidth.ExtraSmall }).Result;
        if (!d.Cancelled)
        {
            var rs = (Student)d.Data;
            data.FistName = rs.FistName;
            data.LastName = rs.LastName;
            data.ParentsPhoneNumber = rs.ParentsPhoneNumber;
            await db.SaveRecord<List<Student>>(table.table_student, studentlist);
        }
    }
}


<div class="row">
    <div class="col-md-12">
        <MudPaper Class="p-3 mb-3" Elevation="25">
            <MudToolBar Dense Class="mb-3 p-0">
                <MudSpacer />
                <MudButton OnClick="OnAddClick" Variant="Variant.Filled" StartIcon="@Icons.Rounded.PersonAdd" Color="Color.Primary" Size="Size.Small">New Student</MudButton>
            </MudToolBar>
            <MudTable Outlined Items="studentlist" T="Student" SortLabel="Sort by" Hover Dense>
                <HeaderContent>
                    <MudTh><MudTableSortLabel SortBy="new Func<Student, object>(x=>x.FistName)">First Name</MudTableSortLabel></MudTh>
                    <MudTh><MudTableSortLabel SortBy="new Func<Student, object>(x=>x.LastName)">Last Name</MudTableSortLabel></MudTh>
                    <MudTh><MudTableSortLabel SortBy="new Func<Student, object>(x=>x.ParentsPhoneNumber)">Parent's Contact</MudTableSortLabel></MudTh>
                    <MudTh><MudTableSortLabel SortBy="new Func<Student, object>(x=>x.ParentsPhoneNumber)">Grade Level</MudTableSortLabel></MudTh>
                    <MudTh Style="width:1%">*</MudTh>
                </HeaderContent>
                <RowTemplate>
                    <MudTd DataLabel="Fist Name">@context.FistName</MudTd>
                    <MudTd DataLabel="Last Name">@context.LastName</MudTd>
                    <MudTd DataLabel="Parent's Contact">@context.ParentsPhoneNumber</MudTd>
                    <MudTd DataLabel="Grade Level">@context.GradeLevel</MudTd>
                    <MudTd>
                        <MudTooltip Placement="Placement.Start" Text="Edit">
                            <MudIconButton Color="Color.Primary" Size="Size.Small" Icon="@Icons.Rounded.Edit" Class="p-0" OnClick="@(()=> EditStudentClick(context))" />
                        </MudTooltip>
                    </MudTd>
                </RowTemplate>
                <PagerContent>
                    <MudTablePager PageSizeOptions="new int[]{50, 100}" />
                </PagerContent>
            </MudTable>
           
        </MudPaper>
    </div>
</div>